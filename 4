import streamlit as st
import pycountry
from utils.country_review import db_get_country_domains, comply_writer
import pandas as pd
from io import BytesIO
from utils.db_pedia import get_db_data

st.set_page_config(
        page_title="Coverage research",
        page_icon="ðŸ”¬"
)


st.title("Country Reviews")
st.header("Set up Your Research Sheet", divider="rainbow")
st.subheader("Select Country for Review")
countries = []
for i in pycountry.countries:
    countries.append(i.name)

country_selectbox = st.selectbox(label="Select country", options=countries, index=None, placeholder="Select Country for Review")

st.subheader("Extract Comply Data")
st.write("Extract domains from Comply Advantage db")
query_btn = st.button(label="Get domains")

if query_btn:
    if country_selectbox is None:
        st.warning("Select Country!")
        exit()
    country_code: str = pycountry.countries.get(name=country_selectbox).alpha_2 
    country_data: pd.DataFrame = db_get_country_domains(country_code)
    excel_data_io: BytesIO = comply_writer(country_data, country_code)
    st.dataframe(country_data)
    st.download_button(label="Download research sheet", data=excel_data_io, file_name=f"AM Coverage in {country_selectbox}.xlsx", mime='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet')

st.subheader("Select DBPedia")

form = st.form()
dbPedia_btn = st.button(label="Get DBPEdia")

if form:
    if dbPedia_btn:
        x = get_db_data()
        st.dataframe(x)
